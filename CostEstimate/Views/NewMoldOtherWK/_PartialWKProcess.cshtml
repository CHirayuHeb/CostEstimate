@using System.Security.Claims;
@model CostEstimate.Models.Common.Class;
@using CostEstimate.Models.Common;
@*@model IEnumerable<IGrouping<string, CostEstimate.Models.Table.MK.ViewceMastProcess>>*@
@{
    string _Permission = User.Claims.FirstOrDefault(s => s.Type == "Permission").Value;
    string _NickName = User.Claims.FirstOrDefault(s => s.Type == "NICKNAME")?.Value;
    string _Name = User.Claims.FirstOrDefault(s => s.Type == "Name")?.Value;
    string _SurName = User.Claims.FirstOrDefault(s => s.Type == "SurName")?.Value;
    string _Division = User.Claims.FirstOrDefault(s => s.Type == "Division")?.Value;
    string _Section = User.Claims.FirstOrDefault(s => s.Type == "Section")?.Value;
    string _admin = GlobalVariable.perAdmin.ToUpper();

}


<div class="" style="border:0px solid gray;margin-top:10px;padding:2px;">
    <div class="grid-item fw-800 center " style="text-align:left;font-size:14px;margin-bottom:10px;">
        Process Detail.
    </div>



    @for (int k = 0; k <= 5; k++)
    {
        <div class="table-group table-containerHM " style="margin:auto" data-index="@k">
            <table class="tbgreen" style="width:100%;margin-right:10px">
                <tr>
                    <th style="width:200px" rowspan="2">
                        <span style="display:inline-block; width:150px;">
                            Part namedddddd
                        </span>

                    </th>
                    @for (int p = 0; p < @Model._ListViewceSubWorkingTimeRequestItem.Count(); p++)
                    {
                        <th colspan="2" rowspan="@(Model._ListViewceSubWorkingTimeRequestItem[p].wriEnable_WTAuto == false ? 2 : 1)">
                            <span>@Model._ListViewceSubWorkingTimeRequestItem[p].wriProcessName</span>
                        </th>

                    }
                    <th rowspan="2">TOTAL</th>
                    <th rowspan="2">REMAIN</th>
                </tr>

                <tr>
                    @for (int p = 0; p < @Model._ListViewceSubWorkingTimeRequestItem.Count(); p++)
                    {
                        if (@Model._ListViewceSubWorkingTimeRequestItem[p].wriEnable_WTAuto == true)
                        {
                            <td>MAN</td>
                            <td>AUTO</td>
                        }

                    }

                </tr>
                <tr>
                    <td style="text-align:left;padding:7px;">
                        <span style="display:inline-block; width:150px;">
                            Cavity No. : Auto
                        </span>
                        <span style="display:inline-block; width:150px;">
                            Type of Cavity : Auto
                        </span>

                      
                    </td>
                    @for (int i = 0; i < @Model._ListViewceSubWorkingTimeRequestItem.Count(); i++)
                    {
                        if (@Model._ListViewceSubWorkingTimeRequestItem[i].wriEnable_WTAuto == false)
                        {
                            <td colspan="2">
                                <input asp-for="_ListViewceSubWorkingTimeRequestItem[i].wriEnable_WTMan" class="form-control center" autocomplete="off" style="width:100%;height:80%;font-size:10px;display:none" value="@Model._ListViewceSubWorkingTimeRequestItem[i].wriEnable_WTMan" type="text" />
                                <input asp-for="_ListViewceSubWorkingTimeRequestItem[i].wriWT_Man" class="form-control center input-man" autocomplete="off" style="@(Model._ListViewceSubWorkingTimeRequestItem[i].wriEnable_WTMan == false ? "width:100px;height:80%;font-size:10px;background-color:darkgrey" : "width:100px;height:80%;font-size:10px;background-color:yellow")" value="@Model._ListViewceSubWorkingTimeRequestItem[i].wriWT_Man" type="number" readonly="@(Model._ListViewceSubWorkingTimeRequestItem[i].wriEnable_WTMan == false ? "readonly" : null)" min="0" />

                                <input asp-for="_ListViewceSubWorkingTimeRequestItem[i].wriEnable_WTAuto" class="form-control center" autocomplete="off" style="display:none;width:100%;height:80%;font-size:10px;display:none" value="@Model._ListViewceSubWorkingTimeRequestItem[i].wriEnable_WTAuto" type="text" />
                                <input asp-for="_ListViewceSubWorkingTimeRequestItem[i].wriWT_Auto" class="form-control center input-auto" autocomplete="off" style="display:none;@(Model._ListViewceSubWorkingTimeRequestItem[i].wriEnable_WTAuto == false ? "width:100px;height:80%;font-size:10px;background-color:darkgrey" : "width:100px;height:80%;font-size:10px;background-color:yellow")" value="@Model._ListViewceSubWorkingTimeRequestItem[i].wriWT_Auto" type="number" readonly="@(Model._ListViewceSubWorkingTimeRequestItem[i].wriEnable_WTAuto == false ? "readonly" : null)" min="0" />

                            </td>
                        }
                        else
                        {
                            <td>
                                <input asp-for="_ListViewceSubWorkingTimeRequestItem[i].wriEnable_WTMan" class="form-control center" autocomplete="off" style="width:100%;height:80%;font-size:10px;display:none" value="@Model._ListViewceSubWorkingTimeRequestItem[i].wriEnable_WTMan" type="text" />
                                <input asp-for="_ListViewceSubWorkingTimeRequestItem[i].wriWT_Man" class="form-control center input-man" autocomplete="off" style="@(Model._ListViewceSubWorkingTimeRequestItem[i].wriEnable_WTMan == false ? "width:100px;height:80%;font-size:10px;background-color:darkgrey" : "width:100px;height:80%;font-size:10px;background-color:yellow")" value="@Model._ListViewceSubWorkingTimeRequestItem[i].wriWT_Man" type="number" readonly="@(Model._ListViewceSubWorkingTimeRequestItem[i].wriEnable_WTMan == false ? "readonly" : null)" min="0" />
                            </td>
                            <td>
                                <input asp-for="_ListViewceSubWorkingTimeRequestItem[i].wriEnable_WTAuto" class="form-control center" autocomplete="off" style="width:100%;height:80%;font-size:10px;display:none" value="@Model._ListViewceSubWorkingTimeRequestItem[i].wriEnable_WTAuto" type="text" />
                                <input asp-for="_ListViewceSubWorkingTimeRequestItem[i].wriWT_Auto" class="form-control center input-auto" autocomplete="off" style="@(Model._ListViewceSubWorkingTimeRequestItem[i].wriEnable_WTAuto == false ? "width:100px;height:80%;font-size:10px;background-color:darkgrey" : "width:100px;height:80%;font-size:10px;background-color:yellow")" value="@Model._ListViewceSubWorkingTimeRequestItem[i].wriWT_Auto" type="number" readonly="@(Model._ListViewceSubWorkingTimeRequestItem[i].wriEnable_WTAuto == false ? "readonly" : null)" min="0" />
                            </td>
                        }


                    }
                    <th>
                        <input type="number" class="form-control input-total txt-right" style="width:100px;height:80%;font-size:10px;background-color:lightgray" autocomplete="off" readonly>
                    </th>
                    <th>
                        <input type="number" class="form-control input-remain txt-right" style="width:100px;height:80%;font-size:10px;background-color:lightgray" autocomplete="off" readonly>
                    </th>
                </tr>
            </table>

            <table class="tbgreen">
                <tr>
                    <th rowspan="2">
                        <span style="display:inline-block; width:80px;">
                            Size Product
                        </span>
                    </th>
                    <th>X</th>
                    <th>Y</th>
                    <th>Z</th>
                    <td rowspan="2" >
                        @Html.DropDownListFor(m => m._ViewceMastModifyRequest.mfIssueDept, (SelectList)ViewBag.TypeofSizeProduct, "กรุณาเลือก", new { @class = "form-control", id = "i_NewMoldOtherWK", autocomplete = "off", @style = "width:100px;font-size:12px;background-color:yellow;height:80%;" })
                    </td>
                </tr>
                <tr>
                    <td>
                        <input type="number" class="form-control left input-x" style="width:80px;height:80%;font-size:10px;background-color:yellow" autocomplete="off" value="@k">
                    </td>
                    <td>
                        <input type="number" class="form-control left input-y" style="width:80px;height:80%;font-size:10px;background-color:yellow" autocomplete="off" value="@k">
                    </td>
                    <td>
                        <input type="number" class="form-control left input-z" style="width:80px;height:80%;font-size:10px;background-color:yellow" autocomplete="off" value="@k">
                    </td>

                </tr>





            </table>


        </div>


    }





</div>

<script>
    function calcRowTotals() {
        // หาทุกแถวในตาราง (ยกเว้น header)
        const rows = document.querySelectorAll(".tbgreen tr");

        rows.forEach(row => {
            const manInputs = row.querySelectorAll(".input-man");
            const autoInputs = row.querySelectorAll(".input-auto");
            const totalInput = row.querySelector(".input-total");
            const remainInput = row.querySelector(".input-remain");


            if (totalInput) {
                // ฟังก์ชันคำนวณรวมในแถว
                const updateTotal = () => {
                    let sum = 0;
                    [...manInputs, ...autoInputs].forEach(inp => {
                        let val = parseFloat(inp.value) || 0;
                        sum += val;
                    });
                    totalInput.value = sum;
                    remainInput.value = sum;
                };

                // ผูก event ให้คำนวณใหม่เมื่อกรอกค่า
                [...manInputs, ...autoInputs].forEach(input => {
                    input.addEventListener("input", updateTotal);
                });

                // คำนวณครั้งแรกตอนโหลดหน้า
                updateTotal();
            }
        });
    }

    // เรียกฟังก์ชันตอนโหลดหน้า
    document.addEventListener("DOMContentLoaded", calcRowTotals);
</script>